// game.js - ä¼˜åŒ–ç‰ˆ

// --- 1. å›¾ç‰‡é¢„åŠ è½½ (è§£å†³é¦–æ¬¡ç”Ÿæˆå¡é¡¿) ---
const preLoadImages = [
    // å»ºç­‘
    'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build4.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build3.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build17.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build18.png',
    'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build13.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build9.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build10.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build15.png',
    'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build7.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build1.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build14.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build11.png',
    'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build5.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build2.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build6.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build16.png',
    // äººç‰©
    'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character1.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character2.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character3.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character4.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character5.png', 'https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character6.png'
];
preLoadImages.forEach(src => { new Image().src = src; });

// --- æ•°æ®å®šä¹‰ ---
let resources = { treasury: 50, people: 50, military: 50, culture: 50 }, incomeRates = { treasury: 5, people: 5, military: 5, culture: 5 };
const BUILD_THRESHOLDS = [80, 150, 220];
let buildingLevels = {}, occupiedPositions = { back: [], mid: [], front: [] }, spawnedBuildings = { treasury: [], people: [], military: [], culture: [] };

// å»ºç­‘å®šä¹‰ (å·²æ›´æ–°)
const buildingDefinitions = {
    treasury: [ 
        { name: "å†œç”°", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build4.png" }, 
        { name: "ç²®ä»“", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build3.png" }, 
        { name: "æ¼•è¿ç å¤´", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build17.png" }, 
        { name: "å¸‚é›†", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build18.png" }
    ],
    people: [ 
        { name: "å¯ºåº™", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build13.png" }, 
        { name: "æˆå°", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build9.png" }, 
        { name: "é“åŒ é“º", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build10.png" }, 
        { name: "æ°´åˆ©å·¥ç¨‹", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build15.png" }
    ],
    military: [ 
        { name: "æ¼”æ­¦åœº", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build7.png" }, 
        { name: "çƒ½ç«å°", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build1.png" }, 
        { name: "é•¿åŸ", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build14.png" }, 
        { name: "æ­¦å™¨åº—", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build11.png" }
    ],
    culture: [ 
        { name: "èŒ¶é¦†", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build5.png" }, 
        { name: "å›½å­ç›‘", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build2.png" }, 
        { name: "ç”»èˆ«", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build6.png" }, 
        { name: "å­¦å ‚", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/build16.png" }
    ]
};

// æ”¿ç­–æ ‘
const policyTrees = [ [ { id: "c1", title: "å¼€å‡¿å¤§è¿æ²³", desc: "éš‹å ¤æ¨æŸ³ï¼Œæ±´æ°´æµæ·Œã€‚è¿æ²³æ²Ÿé€šå—åŒ—ï¼Œè™½åˆ©åœ¨åƒç§‹ï¼Œç„¶æ­¤æ—¶å¾å‘ä»¤ä¸‹ï¼Œç™¾ä¸‡æ°‘å¤«èƒŒäº•ç¦»ä¹¡ã€‚", left: { text: "æœ•å¿ƒå·²å†³ï¼Œå³åˆ»å¼€å·¥ï¼", effect: { treasury: -20, people: -10 }, nextId: "c2_start" }, right: { text: "ç™¾å§“æ–¹å®‰ï¼Œæ­¤äº‹ä½œç½¢ã€‚", effect: { treasury: 10, people: 10 }, nextId: "c2_stop" } }, { id: "c2_stop", title: "ä¼‘å…»ç”Ÿæ¯", desc: "æ—¨æ„ä¸€ä¸‹ï¼Œä¸¾å›½æ¬¢è…¾ã€‚ä½†å—æ–¹æ¼•è¿ä¸é€šï¼Œé•¿å®‰ç±³ä»·é£æ¶¨ã€‚", left: { text: "å¼€ä»“æ”¾ç²®", effect: { treasury: -10, people: 10 }, nextId: "c3_stop_good" }, right: { text: "å¸‚åœºä¹‹äº‹ï¼Œéšå®ƒå»å§", effect: { treasury: 5, people: -10 }, nextId: "c3_stop_bad" } }, { id: "c3_stop_good", title: "ç››ä¸–å®‰å®", desc: "ç™¾å§“æ„Ÿå¿µçš‡æ©ï¼Œè™½æ— å¤§å·¥ï¼Œä½†æ ¹åŸºç¨³å›ºã€‚", left: { text: "å‡ç¨", effect: { treasury: -5, people: 10 }, nextId: "c4_end_peace" }, right: { text: "é¼“åŠ±å†œæ¡‘", effect: { treasury: 5, people: 5 }, nextId: "c4_end_peace" } }, { id: "c3_stop_bad", title: "æ°‘å˜å››èµ·", desc: "é¥¥é¥¿çš„ç™¾å§“å¼€å§‹æŠ¢ç²®ã€‚", left: { text: "è°ƒå…µé•‡å‹", effect: { military: 5, people: -10 }, nextId: "c4_end_chaos" }, right: { text: "è¢«è¿«å¦¥å", effect: { treasury: -20, people: 5 }, nextId: "c4_end_weak" } }, { id: "c4_end_peace", title: "å›½æ³°æ°‘å®‰", desc: "å›½å®¶è™½æ— å¤§å·¥ï¼Œä½†ç™¾å§“å¯Œè¶³ã€‚", left: { text: "...", effect: { culture: 15 }, nextId: "end" }, right: { text: "...", effect: { culture: 15 }, nextId: "end" } }, { id: "c4_end_chaos", title: "åŠ¨è¡ä¸å®‰", desc: "åŠ¨ä¹±è™½å¹³ï¼Œå…ƒæ°”å¤§ä¼¤ã€‚", left: { text: "...", effect: { military: 5 }, nextId: "end" }, right: { text: "...", effect: { military: 5 }, nextId: "end" } }, { id: "c4_end_weak", title: "å¨ä¿¡æ‰«åœ°", desc: "æœå»·å¨ä¿¡æ‰«åœ°ã€‚", left: { text: "...", effect: { culture: -10 }, nextId: "end" }, right: { text: "...", effect: { culture: -10 }, nextId: "end" } }, { id: "c2_start", title: "å·¥ç¨‹æµ©å¤§", desc: "å¾å‘ä»¤å‡ºï¼Œä¸­åŸå¤§åœ°æ»¡ç›®ç–®ç—ã€‚", left: { text: "é‡‡çº³å»ºè®®", effect: { treasury: -5 }, nextId: "c3_build_smart" }, right: { text: "æŒ‰åŸè®¡åˆ’æ‰§è¡Œ", effect: { treasury: -10, people: -5 }, nextId: "c3_build_hard" } }, { id: "c3_build_smart", title: "æ²³é“æ”¹é“", desc: "å¼•å‘è±ªå¼ºä¸æ»¡ã€‚", left: { text: "å¼ºè¡Œé€šè¿‡", effect: { people: -10, military: 5 }, nextId: "c4_build_force" }, right: { text: "ç»•é“è€Œè¡Œ", effect: { treasury: -20 }, nextId: "c4_build_soft" } }, { id: "c3_build_hard", title: "é…·åç›‘å·¥", desc: "æ­»ä¼¤æ— æ•°ã€‚", left: { text: "ä¸¥æƒ©é…·å", effect: { people: 10 }, nextId: "c4_build_soft" }, right: { text: "é»˜è®¸", effect: { people: -20, treasury: 10 }, nextId: "c4_build_force" } }, { id: "c4_build_soft", title: "ä»æ”¿å·¥ç¨‹", desc: "æ°‘å¿ƒå¯ç”¨ã€‚", left: { text: "...", effect: { people: 20 }, nextId: "c5_end_good" }, right: { text: "...", effect: { people: 20 }, nextId: "c5_end_good" } }, { id: "c4_build_force", title: "æš´æ”¿å·¥ç¨‹", desc: "å°¸éª¨ç´¯ç´¯ã€‚", left: { text: "...", effect: { treasury: 30 }, nextId: "c5_end_bad" }, right: { text: "...", effect: { treasury: 30 }, nextId: "c5_end_bad" } }, { id: "c5_end_good", title: "è¿æ²³æ¸…æ³¢", desc: "ä¸¤å²¸ç™¾å§“å¤¹é“æ¬¢è¿ã€‚", left: { text: "å¥½", effect: { culture: 20 }, nextId: "end" }, right: { text: "å¥½", effect: { culture: 20 }, nextId: "end" } }, { id: "c5_end_bad", title: "è¡€è‰²è¿æ²³", desc: "æ€¨æ°”å†²å¤©ã€‚", left: { text: "å”‰", effect: { people: -20 }, nextId: "end" }, right: { text: "å”‰", effect: { people: -20 }, nextId: "end" } } ], [ { id: "b1", title: "çªå¥å—ä¸‹", desc: "åŒ—æ–¹çªå¥å¤§å†›å‹å¢ƒï¼Œè¾¹å…³å‘Šæ€¥ã€‚", left: { text: "çº³è´¡ç§°è‡£", effect: { treasury: -20, people: -10 }, nextId: "b2_peace" }, right: { text: "å¾¡é©¾äº²å¾", effect: { treasury: -10, military: 5 }, nextId: "b2_war" } }, { id: "b2_peace", title: "å±ˆè¾±æ±‚å’Œ", desc: "ç´¢è¦ä¸‰å·ä¹‹åœ°ã€‚", left: { text: "å¿è¾±å‰²åœ°", effect: { people: -20, military: -10 }, nextId: "b3_peace_cut" }, right: { text: "æ’•æ¯æ¡çº¦", effect: { treasury: -10, military: 10 }, nextId: "b3_peace_war" } }, { id: "b3_peace_cut", title: "å›½åœŸæ²¦ä¸§", desc: "ç™¾å§“æµç¦»å¤±æ‰€ã€‚", left: { text: "ä¸‹è¯ç½ªå·±", effect: { people: 5, culture: -5 }, nextId: "b4_end_shame" }, right: { text: "å°é”æ¶ˆæ¯", effect: { culture: -10 }, nextId: "b4_end_dark" } }, { id: "b3_peace_war", title: "çªè¢­æ•Œè¥", desc: "è¶æ•Œå†›æ¾æ‡ˆï¼Œå¤œè¢­æ•Œè¥ã€‚", left: { text: "å¤§èƒœ", effect: { military: 20 }, nextId: "b4_end_win" }, right: { text: "æƒ¨èƒœ", effect: { military: 10, people: -5 }, nextId: "b4_end_win" } }, { id: "b4_end_shame", title: "åå®‰ä¸€éš…", desc: "å¤§å”è™½å­˜ï¼Œå·²æ— å¤©å¯æ±—ä¹‹å¨ã€‚", left: { text: "...", effect: { culture: -10 }, nextId: "end" }, right: { text: "...", effect: { culture: -10 }, nextId: "end" } }, { id: "b4_end_dark", title: "ç²‰é¥°å¤ªå¹³", desc: "è¾¹å¢ƒå±æœºå››ä¼ã€‚", left: { text: "...", effect: { treasury: 10 }, nextId: "end" }, right: { text: "...", effect: { treasury: 10 }, nextId: "end" } }, { id: "b4_end_win", title: "é€†é£ç¿»ç›˜", desc: "æ‰“å‡ºäº†å¤§å”çš„å¨é£ã€‚", left: { text: "...", effect: { military: 20 }, nextId: "end" }, right: { text: "...", effect: { military: 20 }, nextId: "end" } }, { id: "b2_war", title: "æˆ˜å±€èƒ¶ç€", desc: "æœ‰å°†é¢†å»ºè®®ä½¿ç”¨ç«æ”»ã€‚", left: { text: "ç«æ”»", effect: { military: 10, people: -5 }, nextId: "b3_war_fire" }, right: { text: "å¼ºæ”»", effect: { military: -5, treasury: -10 }, nextId: "b3_war_charge" } }, { id: "b3_war_fire", title: "çƒˆç«ç„šåŸ", desc: "çªå¥æºƒè´¥ã€‚", left: { text: "èƒœäº†", effect: { military: 10, culture: -5 }, nextId: "b4_end_fire" }, right: { text: "æ— å¥ˆ", effect: { military: 5 }, nextId: "b4_end_fire" } }, { id: "b3_war_charge", title: "æƒ¨èƒœ", desc: "ä¼¤äº¡æƒ¨é‡ã€‚", left: { text: "æŠšæ¤", effect: { treasury: -10, people: 10 }, nextId: "b4_end_blood" }, right: { text: "æ•´é¡¿", effect: { military: 5 }, nextId: "b4_end_blood" } }, { id: "b4_end_fire", title: "ç„¦åœŸä¹‹æˆ˜", desc: "ç™¾å¹´ä¸æ•¢å—ä¸‹ã€‚", left: { text: "...", effect: { military: 10 }, nextId: "end" }, right: { text: "...", effect: { military: 10 }, nextId: "end" } }, { id: "b4_end_blood", title: "é“è¡€é•¿æ­Œ", desc: "ç­‘èµ·äº†æ–°çš„é•¿åŸã€‚", left: { text: "...", effect: { people: 10 }, nextId: "end" }, right: { text: "...", effect: { people: 10 }, nextId: "end" } } ], [ { id: "f1", title: "ä½›æ³•å¤§å…´", desc: "å„åœ°å¯ºé™¢ç»æµè†¨èƒ€ï¼Œè‰¯ç”°çš†å½’ä½›é—¨ã€‚", left: { text: "å°Šå´‡ä½›æ•™", effect: { treasury: -20, culture: 20 }, nextId: "f2_build" }, right: { text: "ä¸‹ä»¤ç­ä½›", effect: { treasury: 30, culture: -15 }, nextId: "f2_kill" } }, { id: "f2_build", title: "ä¸¾å›½ç‹‚çƒ­", desc: "å†œç”°è’èŠœã€‚", left: { text: "é€‚åº¦å¼•å¯¼", effect: { culture: 10, people: 5 }, nextId: "f3_build_good" }, right: { text: "é¡ºå…¶è‡ªç„¶", effect: { people: -10, culture: 10 }, nextId: "f3_build_bad" } }, { id: "f3_build_good", title: "ä½›å…‰æ™®ç…§", desc: "ç¤¾ä¼šå®‰å®šã€‚", left: { text: "åŠŸå¾·æ— é‡", effect: { culture: 20 }, nextId: "f4_end_holy" }, right: { text: "å–„å“‰", effect: { people: 10 }, nextId: "f4_end_holy" } }, { id: "f3_build_bad", title: "å›½åº“ç©ºè™š", desc: "å›½å®¶è´¢æ”¿å´©æºƒã€‚", left: { text: "æ— å¥ˆ", effect: { treasury: -20 }, nextId: "f4_end_poor" }, right: { text: "åæ‚”", effect: { people: -10 }, nextId: "f4_end_poor" } }, { id: "f4_end_holy", title: "è¥¿æ–¹æä¹", desc: "å¤§å”æˆä¸ºä½›å›½åœ£åœ°ã€‚", left: { text: "...", effect: { culture: 10 }, nextId: "end" }, right: { text: "...", effect: { culture: 10 }, nextId: "end" } }, { id: "f4_end_poor", title: "å¯ºåº™å¯Œç”²", desc: "ç™¾å§“é£Ÿä¸æœè…¹ã€‚", left: { text: "...", effect: { treasury: -10 }, nextId: "end" }, right: { text: "...", effect: { treasury: -10 }, nextId: "end" } }, { id: "f2_kill", title: "ä½›åƒç†”é‡‘", desc: "åƒ§ä¾£èšé›†æŠ—è®®ã€‚", left: { text: "å¼ºåŠ›é©±æ•£", effect: { people: -10, military: 5 }, nextId: "f3_kill_hard" }, right: { text: "å®‰æŠšåŠå¯¼", effect: { people: 5 }, nextId: "f3_kill_soft" } }, { id: "f3_kill_hard", title: "è¡€æŸ“è¢ˆè£Ÿ", desc: "èƒŒè´Ÿäº†éª‚åã€‚", left: { text: "å€¼å¾—", effect: { treasury: 20, culture: -10 }, nextId: "f4_end_rich" }, right: { text: "æ®‹å¿", effect: { treasury: 10 }, nextId: "f4_end_rich" } }, { id: "f3_kill_soft", title: "è¿˜ä¿—ä¸ºæ°‘", desc: "å¢åŠ äº†åŠ³åŠ¨åŠ›ã€‚", left: { text: "å¾ˆå¥½", effect: { people: 10, treasury: 10 }, nextId: "f4_end_live" }, right: { text: "ä¸é”™", effect: { people: 5 }, nextId: "f4_end_live" } }, { id: "f4_end_rich", title: "å¯Œå›½å¼ºå…µ", desc: "å›½åº“å……ç›ˆã€‚", left: { text: "...", effect: { treasury: 10 }, nextId: "end" }, right: { text: "...", effect: { treasury: 10 }, nextId: "end" } }, { id: "f4_end_live", title: "è€•è¯»ä¼ å®¶", desc: "ä½›å¯ºå˜æˆäº†å­¦å ‚ã€‚", left: { text: "...", effect: { people: 15 }, nextId: "end" }, right: { text: "...", effect: { people: 15 }, nextId: "end" } } ] ];

// äººç‰©å‰§æœ¬ (åº•å±‚é•¿èŠ‚ç‚¹ + ç²¾è‹±å‰§æœ¬)
const characterStories = [
    { name: "é•¿å®‰Â·ç¯ç«é˜‘çŠå¤„", list: [ { id: "a1", title: "ä¸Šå…ƒä¹‹å¤œ", desc: "é•¿å®‰ç¯ç«å¦‚æ˜¼ã€‚å–§é—¹å£°ä¸­ï¼Œä½ å¿½ç„¶ç¥è§å··å£é‚£ç›å­¤ç¯ä¸‹ï¼Œæœ‰ä¸ªèƒŒå½±åƒæäº†å½“å¹´çš„å¥¹ã€‚", left: { text: "è¿½ä¸Šå»", effect: { common: 1 }, nextId: "a2_chase" }, right: { text: "é©»è¶³å‡æœ›", effect: { literary: 1 }, nextId: "a2_stay" } }, { id: "a2_chase", title: "è¯¯å…¥æ·±å··", desc: "åªè§å‡ ä¸ªæ³¼çš®æ— èµ–æ­£å›´ç€ä¸€è¾†é©¬è½¦ã€‚", left: { text: "æŒºèº«è€Œå‡º", effect: { martial: 1 }, nextId: "a3_hero" }, right: { text: "å·§å¦™å‘¨æ—‹", effect: { merchant: 1 }, nextId: "a3_smart" } }, { id: "a3_hero", title: "ä¾ ä¹‰ä¹‹ä¸¾", desc: "ä½ æ‰“é€€äº†æ— èµ–ã€‚é©¬è½¦å¸˜å­æ€å¼€ï¼Œç«Ÿæ˜¯å½“æœå®°ç›¸çš„åƒé‡‘ã€‚", left: { text: "æ”¶ä¸‹ç‰ä½©", effect: { merchant: 1 }, nextId: "a4_path1" }, right: { text: "å©‰æ‹’ç¦»å¼€", effect: { literary: 2 }, nextId: "a4_path2" } }, { id: "a3_smart", title: "æ™ºé€€æ— èµ–", desc: "å¤§å–Šï¼šâ€œå·¡è¡—æ­¦ä¾¯æ¥äº†ï¼â€", left: { text: "æ·±è—åŠŸå", effect: { literary: 1 }, nextId: "a4_path2" }, right: { text: "ç´¢è¦æŠ¥é…¬", effect: { merchant: 1 }, nextId: "a4_path1" } }, { id: "a4_path1", title: "å¹³æ­¥é’äº‘", desc: "åœ¨è´µäººçš„å¸®åŠ©ä¸‹ï¼Œä½ å…¥æœä¸ºå®˜ã€‚", left: { text: "æ¸…å»‰æ­£ç›´", effect: { literary: 2 }, nextId: "a5_official" }, right: { text: "ç»“å…šè¥ç§", effect: { merchant: 2 }, nextId: "a5_rich" } }, { id: "a4_path2", title: "è‹¦è¯»è¯—ä¹¦", desc: "ä¸‰å¹´åï¼Œé‡‘æ¦œé¢˜åã€‚", left: { text: "å¤–æ”¾å¿ä»¤", effect: { common: 2 }, nextId: "a5_county" }, right: { text: "ç•™ä»»äº¬å®˜", effect: { literary: 2 }, nextId: "a5_official" } }, { id: "a5_official", title: "ä»•é€”æ²‰æµ®", desc: "é£äº‘å˜å¹»ã€‚", left: { text: "æ˜å“²ä¿èº«", effect: { literary: 1 }, nextId: "a6_end_official" }, right: { text: "é”æ„æ”¹é©", effect: { common: 1 }, nextId: "a6_end_official" } }, { id: "a5_rich", title: "å•†æµ·æµ®æ²‰", desc: "å•†åœºå¦‚é±¼å¾—æ°´ã€‚", left: { text: "...", effect: { merchant: 2 }, nextId: "a6_end_rich" }, right: { text: "...", effect: { merchant: 2 }, nextId: "a6_end_rich" } }, { id: "a5_county", title: "å¿ä»¤å²æœˆ", desc: "é€ ç¦ä¸€æ–¹ã€‚", left: { text: "...", effect: { common: 2 }, nextId: "a6_end_county" }, right: { text: "...", effect: { common: 2 }, nextId: "a6_end_county" } }, { id: "a6_end_official", title: "æœå»·æ ‹æ¢", desc: "åœ¨é‚£ä¸ªç¯ç«é˜‘çŠå¤„ï¼Œä½ æ‰¾åˆ°äº†å¥¹ã€‚", left: { text: "End", effect: { literary: 3 }, nextId: "end" }, right: { text: "End", effect: { literary: 3 }, nextId: "end" } }, { id: "a6_end_rich", title: "å¯Œç”²ä¸€æ–¹", desc: "å´å†ä¹Ÿæ²¡è§è¿‡é‚£ä¸ªèƒŒå½±ã€‚", left: { text: "End", effect: { merchant: 3 }, nextId: "end" }, right: { text: "End", effect: { merchant: 3 }, nextId: "end" } }, { id: "a6_end_county", title: "çˆ±æ°‘å¦‚å­", desc: "ç™¾å§“ä¸ºä½ ç«‹ç”Ÿç¥ ã€‚", left: { text: "End", effect: { common: 3 }, nextId: "end" }, right: { text: "End", effect: { common: 3 }, nextId: "end" } } ] },
    { name: "å‡‰å·Â·å¤§æ¼ å­¤çƒŸç›´", list: [ { id: "b1", title: "å¾å…µä»¤", desc: "å®˜å·®çš„é©¬è¹„å£°è¸ç ´äº†å°æ‘çš„å®é™ã€‚ä½ æ˜¯å®¶ä¸­ç‹¬å­ã€‚", left: { text: "æ›¿çˆ¶ä»å†›", effect: { martial: 1 }, nextId: "b2_army" }, right: { text: "è´¿èµ‚å®˜å·®", effect: { merchant: 1 }, nextId: "b2_escape" } }, { id: "b2_army", title: "è¾¹å…³å†·æœˆ", desc: "å†›æ—…ç”Ÿæ¶¯è‹¦å¯’ã€‚ä¸€æ¬¡å·¡é€»ä¸­ï¼Œèº«è¾¹çš„æˆ˜å‹ä¸­ç®­å€’åœ°ã€‚", left: { text: "å†’æ­»èƒŒå›", effect: { common: 1 }, nextId: "b3_save" }, right: { text: "å«æ³ªå†²é”‹", effect: { martial: 1 }, nextId: "b3_charge" } }, { id: "b3_save", title: "ç”Ÿæ­»å…„å¼Ÿ", desc: "æˆ˜å‹æ´»äº†ä¸‹æ¥ã€‚æˆ˜äº‰ç»“æŸå...", left: { text: "é€€ä¼å›ä¹¡", effect: { common: 2 }, nextId: "b4_farmer" }, right: { text: "ç•™åœ¨å†›è¥", effect: { martial: 2 }, nextId: "b4_soldier" } }, { id: "b3_charge", title: "æ€æ•Œç«‹åŠŸ", desc: "è¢«å°†å†›èµè¯†ææ‹”ã€‚", left: { text: "ç»§ç»­å¥‹æ–—", effect: { martial: 2 }, nextId: "b4_soldier" }, right: { text: "è§å¥½å°±æ”¶", effect: { common: 1 }, nextId: "b4_farmer" } }, { id: "b4_farmer", title: "å½’å›­ç”°å±…", desc: "å¹³æ·¡çš„æ—¥å­ã€‚", left: { text: "åŠ¡å†œ", effect: { common: 2 }, nextId: "b5_end_farmer" }, right: { text: "åŠ¡å†œ", effect: { common: 2 }, nextId: "b5_end_farmer" } }, { id: "b4_soldier", title: "å†›ä¸­æ‚å°†", desc: "å®šæµ·ç¥é’ˆã€‚", left: { text: "è®­ç»ƒæ–°å…µ", effect: { martial: 1 }, nextId: "b5_end_soldier" }, right: { text: "è¯·æ±‚å‡ºå¾", effect: { martial: 2 }, nextId: "b5_end_soldier" } }, { id: "b2_escape", title: "æµæ°‘ä¹‹è·¯", desc: "å®¶è´¢æ•£å°½ã€‚", left: { text: "è½è‰ä¸ºå¯‡", effect: { martial: 1 }, nextId: "b3_bandit" }, right: { text: "è¿›åŸä¹è®¨", effect: { common: 1 }, nextId: "b3_beg" } }, { id: "b3_bandit", title: "å±±å¯¨å¤§ç‹", desc: "å®˜åºœæ‹›å®‰ã€‚", left: { text: "æ¥å—", effect: { military: 1 }, nextId: "b4_soldier" }, right: { text: "æ‹’ç»", effect: { martial: 1 }, nextId: "b5_end_bandit" } }, { id: "b3_beg", title: "é‡è§æ©äºº", desc: "ä¸€ä½å•†äººæ”¶ç•™äº†ä½ ã€‚", left: { text: "æŠ¥æ©", effect: { merchant: 2 }, nextId: "b5_end_merchant" }, right: { text: "æŠ¥æ©", effect: { merchant: 2 }, nextId: "b5_end_merchant" } }, { id: "b5_end_farmer", title: "ç”°å›­å°†èŠœ", desc: "å¹³æ·¡æ‰æ˜¯çœŸã€‚", left: { text: "...", effect: { common: 3 }, nextId: "end" }, right: { text: "...", effect: { common: 3 }, nextId: "end" } }, { id: "b5_end_soldier", title: "ç™¾æˆ˜è€å…µ", desc: "å¨éœ‡è¾¹ç–†ã€‚", left: { text: "...", effect: { martial: 3 }, nextId: "end" }, right: { text: "...", effect: { martial: 3 }, nextId: "end" } }, { id: "b5_end_bandit", title: "æ±Ÿæ¹–æµªå­", desc: "ä¸€æ–¹è±ªæ°ã€‚", left: { text: "...", effect: { martial: 2 }, nextId: "end" }, right: { text: "...", effect: { martial: 2 }, nextId: "end" } }, { id: "b5_end_merchant", title: "å•†è´¾ä¹‹è·¯", desc: "é‡è·æ–°ç”Ÿã€‚", left: { text: "...", effect: { merchant: 3 }, nextId: "end" }, right: { text: "...", effect: { merchant: 3 }, nextId: "end" } } ] },
    { name: "å¸‚äº•Â·è´©å¤«èµ°å’", list: [ { id: "c1", title: "ç»§æ‰¿æ‘Šä½", desc: "çˆ¶äº²å»ä¸–ï¼Œç•™ä¸‹äº†ä¸€ä¸ªå–ç‚Šé¥¼çš„å°æ‘Šä½ã€‚", left: { text: "å‹¤åŠ³ç»è¥", effect: { merchant: 1 }, nextId: "c2_work" }, right: { text: "æƒ³åšå¤§ç”Ÿæ„", effect: { merchant: 1 }, nextId: "c2_risk" } }, { id: "c2_work", title: "è¡—åŠé‚»å±…", desc: "ä½ çš„ç‚Šé¥¼å¥½åƒã€‚", left: { text: "è–„åˆ©å¤šé”€", effect: { common: 1 }, nextId: "c3_stable" }, right: { text: "æ¶¨ä»·èµšä¸€ç¬”", effect: { merchant: 2 }, nextId: "c3_rich" } }, { id: "c2_risk", title: "å€Ÿè´·è¿›è´§", desc: "ä½ å€Ÿäº†é«˜åˆ©è´·ã€‚", left: { text: "è¿æ°”ä¸é”™ï¼Œèµšäº†", effect: { merchant: 2 }, nextId: "c3_rich" }, right: { text: "è¢«éª—äº†ï¼Œç ´äº§", effect: { common: 1 }, nextId: "c3_fail" } }, { id: "c3_stable", title: "å°æœ¬ç”Ÿæ„", desc: "åˆ°äº†é€‚å©šå¹´é¾„ã€‚", left: { text: "å¨¶å¦»ç”Ÿå­", effect: { common: 1 }, nextId: "c4_family" }, right: { text: "æ”’é’±ä¸å¨¶", effect: { merchant: 1 }, nextId: "c4_save" } }, { id: "c3_rich", title: "è¥¿å¸‚è€æ¿", desc: "ç”Ÿæ„ç«çˆ†ã€‚", left: { text: "æ‰©å¤§ç»è¥", effect: { merchant: 1 }, nextId: "c4_big_boss" }, right: { text: "ç¨³å¥ç†è´¢", effect: { common: 1 }, nextId: "c4_safety" } }, { id: "c3_fail", title: "å–èº«è¿˜å€º", desc: "åˆ°å¤§æˆ·äººå®¶åšå®¶ä¸ã€‚", left: { text: "åŠªåŠ›å¹²æ´»", effect: { common: 1 }, nextId: "c4_servant" }, right: { text: "å·æ‡’è€æ»‘", effect: { merchant: 1 }, nextId: "c4_servant" } }, { id: "c4_family", title: "å¨¶å¦»ç”Ÿå­", desc: "ç»™ä½ ç”Ÿäº†ä¸ªå¤§èƒ–å°å­ã€‚", left: { text: "æ•™å¯¼è¯»ä¹¦", effect: { literary: 1 }, nextId: "c5_kid_study" }, right: { text: "ä¼ æˆæ‰‹è‰º", effect: { merchant: 1 }, nextId: "c5_kid_work" } }, { id: "c4_save", title: "æ”’é’±ä¸å¨¶", desc: "æ™šå¹´æ— å¿§ã€‚", left: { text: "å›ä¹¡å…»è€", effect: { common: 2 }, nextId: "c5_end_normal" }, right: { text: "ç»§ç»­æ‘†æ‘Š", effect: { merchant: 2 }, nextId: "c5_end_normal" } }, { id: "c4_big_boss", title: "å¯Œç”²ä¸€æ–¹", desc: "æˆäº†å¯Œå•†å·¨è´¾ã€‚", left: { text: "ç»“äº¤æƒè´µ", effect: { merchant: 1 }, nextId: "c5_end_rich" }, right: { text: "ä½è°ƒåšäºº", effect: { common: 1 }, nextId: "c5_end_rich" } }, { id: "c4_safety", title: "ç¨³å¥ç†è´¢", desc: "å®‰äº«æ™šå¹´ã€‚", left: { text: "...", effect: { common: 2 }, nextId: "c5_end_normal" }, right: { text: "...", effect: { common: 2 }, nextId: "c5_end_normal" } }, { id: "c4_servant", title: "å®¶ä¸ç”Ÿæ¶¯", desc: "å¹²äº†åå¹´ã€‚", left: { text: "ä¸»å®¶èµè¯†", effect: { common: 1 }, nextId: "c5_servant_good" }, right: { text: "è¢«èµ¶å‡ºé—¨", effect: { common: 1 }, nextId: "c5_servant_bad" } }, { id: "c5_kid_study", title: "é‡‘æ¦œé¢˜å", desc: "å„¿å­äº‰æ°”ã€‚", left: { text: "å…‰å®—è€€ç¥–", effect: { literary: 2 }, nextId: "c6_end_pride" }, right: { text: "å…‰å®—è€€ç¥–", effect: { literary: 2 }, nextId: "c6_end_pride" } }, { id: "c5_kid_work", title: "å­æ‰¿çˆ¶ä¸š", desc: "ç”Ÿæ„æ›´çº¢ç«ã€‚", left: { text: "å®‰äº«æ™šå¹´", effect: { common: 2 }, nextId: "c5_end_normal" }, right: { text: "å®‰äº«æ™šå¹´", effect: { common: 2 }, nextId: "c5_end_normal" } }, { id: "c5_servant_good", title: "å¿ ä»†", desc: "èµäº†ä½ ä¸€ç¬”é’±ã€‚", left: { text: "å¼€ä¸ªå°åº—", effect: { merchant: 2 }, nextId: "c6_end_small_shop" }, right: { text: "å‘Šè€è¿˜ä¹¡", effect: { common: 2 }, nextId: "c5_end_normal" } }, { id: "c5_servant_bad", title: "æµè½è¡—å¤´", desc: "æ— å®¶å¯å½’ã€‚", left: { text: "ä¹è®¨ä¸ºç”Ÿ", effect: { common: 1 }, nextId: "c6_end_beggar" }, right: { text: "ä¹è®¨ä¸ºç”Ÿ", effect: { common: 1 }, nextId: "c6_end_beggar" } }, { id: "c6_end_pride", title: "å…‰å®—è€€ç¥–", desc: "ä¸€ç”Ÿæ— æ†¾ã€‚", left: { text: "...", effect: { literary: 3 }, nextId: "end" }, right: { text: "...", effect: { literary: 3 }, nextId: "end" } }, { id: "c6_end_small_shop", title: "å°åº—ä¸»", desc: "æœ‰äº†è‡ªå·±çš„å°åº—ã€‚", left: { text: "...", effect: { merchant: 2 }, nextId: "end" }, right: { text: "...", effect: { merchant: 2 }, nextId: "end" } }, { id: "c6_end_beggar", title: "ä¹ä¸", desc: "ç»ˆè€è¡—å¤´ã€‚", left: { text: "...", effect: { common: 1 }, nextId: "end" }, right: { text: "...", effect: { common: 1 }, nextId: "end" } }, { id: "c5_end_normal", title: "å¸‚äº•å°æ°‘", desc: "å¹³å‡¡çš„ä¸€ç”Ÿã€‚", left: { text: "...", effect: { common: 2 }, nextId: "end" }, right: { text: "...", effect: { common: 2 }, nextId: "end" } }, { id: "c5_end_rich", title: "å¯Œç”²ä¸€æ–¹", desc: "ç”Ÿæ„åšå¤§ã€‚", left: { text: "...", effect: { merchant: 3 }, nextId: "end" }, right: { text: "...", effect: { merchant: 3 }, nextId: "end" } } ] },
    { name: "å·¥åŒ Â·åŒ å¿ƒç‹¬è¿", list: [ { id: "d1", title: "å­¦å¾’ç”Ÿæ¶¯", desc: "å¸ˆçˆ¶ä¸ä»…æ‰“é“ï¼Œè¿˜ä¼šä¿®é”ã€‚", left: { text: "ä¸“å¿ƒå­¦æ‰“é“", effect: { tech: 1 }, nextId: "d2_iron" }, right: { text: "å·å­¦ä¿®é”", effect: { tech: 1 }, nextId: "d2_lock" } }, { id: "d2_iron", title: "æ”¹è‰¯å†œå…·", desc: "ä¹¡äº²ä»¬éƒ½å¤¸ä½ ã€‚", left: { text: "çŒ®ç»™å·¥éƒ¨", effect: { tech: 2 }, nextId: "d3_official" }, right: { text: "åœ¨ä¹¡é‡Œå–", effect: { common: 2 }, nextId: "d3_local" } }, { id: "d2_lock", title: "å¥‡æ€å¦™æƒ³", desc: "å‘æ˜äº†è¿ç¯é”ã€‚", left: { text: "å–ç»™å¯Œå•†", effect: { merchant: 2 }, nextId: "d3_rich" }, right: { text: "çŒ®ç»™å®˜åºœ", effect: { tech: 2 }, nextId: "d3_official" } }, { id: "d3_official", title: "å…¥åŒ ç±", desc: "æˆä¸ºäº†ä¸€åå®˜åŒ ã€‚", left: { text: "å…¢å…¢ä¸šä¸š", effect: { tech: 1 }, nextId: "d4_off_work" }, right: { text: "é’»ç ”å›¾çº¸", effect: { tech: 2 }, nextId: "d4_off_study" } }, { id: "d3_local", title: "ä¹¡é—´ååŒ ", desc: "æ”¶äº†å‡ ä¸ªå¾’å¼Ÿã€‚", left: { text: "ä¼ æˆæŠ€è‰º", effect: { common: 1 }, nextId: "d4_local_teach" }, right: { text: "ä¿å®ˆç§˜å¯†", effect: { merchant: 1 }, nextId: "d4_local_secret" } }, { id: "d3_rich", title: "å¯Œå®¶ç¿", desc: "èµšäº†å¤§é’±ã€‚", left: { text: "ç»§ç»­å‘æ˜", effect: { tech: 2 }, nextId: "d4_rich_invent" }, right: { text: "äº«å—ç”Ÿæ´»", effect: { merchant: 1 }, nextId: "d4_rich_enjoy" } }, { id: "d4_off_work", title: "å®˜åŒ ç”Ÿæ¶¯", desc: "å‚ä¸äº†çš‡é™µçš„ä¿®å»ºã€‚", left: { text: "å› åŠŸå‡è¿", effect: { tech: 1 }, nextId: "d5_elite" }, right: { text: "é€€ä¼‘è¿˜ä¹¡", effect: { common: 2 }, nextId: "d5_end_normal" } }, { id: "d4_off_study", title: "ç¥æœºå¦™ç®—", desc: "æ”¹è‰¯äº†è¿å¼©ã€‚", left: { text: "å‚å†›æ•ˆåŠ›", effect: { martial: 2 }, nextId: "d5_elite" }, right: { text: "ç•™å®ˆå·¥éƒ¨", effect: { tech: 1 }, nextId: "d5_elite" } }, { id: "d4_local_teach", title: "æ¡ƒææ»¡å¤©ä¸‹", desc: "éƒ½å¾ˆå­é¡ºã€‚", left: { text: "å®‰äº«æ™šå¹´", effect: { common: 2 }, nextId: "d5_end_normal" }, right: { text: "ç»§ç»­æ‰“é“", effect: { tech: 1 }, nextId: "d5_end_normal" } }, { id: "d4_local_secret", title: "ç‹¬é—¨ç»æŠ€", desc: "å¼•èµ·åŒè¡Œå«‰å¦’ã€‚", left: { text: "è¢«æ‰“å‹", effect: { common: 1 }, nextId: "d5_end_normal" }, right: { text: "å’Œè§£", effect: { merchant: 1 }, nextId: "d5_end_normal" } }, { id: "d4_rich_invent", title: "å‘æ˜å®¶", desc: "é€ ç¦ä¸€æ–¹ã€‚", left: { text: "çŒ®ç»™æœå»·", effect: { tech: 2 }, nextId: "d5_elite" }, right: { text: "è‡ªå·±ç”¨", effect: { merchant: 1 }, nextId: "d5_end_normal" } }, { id: "d4_rich_enjoy", title: "å¯Œå•†", desc: "æˆäº†å¯Œå•†ã€‚", left: { text: "...", effect: { merchant: 2 }, nextId: "d5_end_normal" }, right: { text: "...", effect: { merchant: 2 }, nextId: "d5_end_normal" } }, { id: "d5_elite", title: "å¤§å›½å·¥åŒ ", desc: "æµèŠ³ç™¾ä¸–ã€‚", left: { text: "...", effect: { tech: 3 }, nextId: "d6_end_elite" }, right: { text: "...", effect: { tech: 3 }, nextId: "d6_end_elite" } }, { id: "d5_end_normal", title: "æ‰‹è‰ºäºº", desc: "æ‰‹è‰ºåƒé¥­ã€‚", left: { text: "...", effect: { common: 2 }, nextId: "end" }, right: { text: "...", effect: { common: 2 }, nextId: "end" } }, { id: "d6_end_elite", title: "ä¸€ä»£å®—å¸ˆ", desc: "æŠ€è‰ºç²¾æ¹›ã€‚", left: { text: "...", effect: { tech: 3 }, nextId: "end" }, right: { text: "...", effect: { tech: 3 }, nextId: "end" } } ] },
    { name: "å†œæ¡‘Â·åœ¨æ­¤å±±ä¸­", list: [ { id: "e1", title: "æ˜¥è€•å¤§å¿™", desc: "æ”¶æˆå¥½åå…¨çœ‹è€å¤©çˆ·ã€‚", left: { text: "ç²¾è€•ç»†ä½œ", effect: { common: 1 }, nextId: "e2_work" }, right: { text: "è¿›åŸæ‰¾æ´»è·¯", effect: { common: 1 }, nextId: "e2_city" } }, { id: "e2_work", title: "é£è°ƒé›¨é¡º", desc: "å®˜åºœæ¥æ”¶ç¨äº†ã€‚", left: { text: "è¶³é¢äº¤ç¨", effect: { treasury: 1 }, nextId: "e3_good" }, right: { text: "è—èµ·ä¸€éƒ¨åˆ†", effect: { treasury: -1 }, nextId: "e3_hide" } }, { id: "e2_city", title: "ç å¤´æ‰›åŒ…", desc: "è™½ç„¶ç´¯ä½†ç°ç»“å·¥é’±ã€‚", left: { text: "æ”’é’±ä¹°åœ°", effect: { common: 2 }, nextId: "e3_land" }, right: { text: "èµŒåšç¿»æœ¬", effect: { merchant: -1 }, nextId: "e3_fail" } }, { id: "e3_good", title: "å®‰å±…ä¹ä¸š", desc: "å†¬å¤©æ¥äº†ã€‚", left: { text: "çººçº±ç»‡å¸ƒ", effect: { common: 1 }, nextId: "e4_winter" }, right: { text: "é—²ç€è¿‡å¹´", effect: { culture: 1 }, nextId: "e4_winter" } }, { id: "e3_hide", title: "è¢«å‘ç°äº†", desc: "ç½šäº†ä½ ä¸€ç¬”ã€‚", left: { text: "æ— å¥ˆäº¤ç½šæ¬¾", effect: { treasury: -1 }, nextId: "e4_fail" }, right: { text: "æ±‚æƒ…", effect: { people: 1 }, nextId: "e4_fail" } }, { id: "e3_land", title: "ç½®åŠå®¶ä¸š", desc: "å›ä¹¡ä¹°äº†åœ°ã€‚", left: { text: "å¨¶å¦»ç”Ÿå­", effect: { common: 2 }, nextId: "e4_family" }, right: { text: "ç‹¬è‡ªç”Ÿæ´»", effect: { common: 1 }, nextId: "e4_alone" } }, { id: "e3_fail", title: "è¡€æœ¬æ— å½’", desc: "èµŒåšè¾“å…‰äº†ç§¯è“„ã€‚", left: { text: "å›ä¹¡åŠ¡å†œ", effect: { common: 1 }, nextId: "e4_fail" }, right: { text: "ç»§ç»­æµæµª", effect: { common: 1 }, nextId: "e4_fail" } }, { id: "e4_winter", title: "å¯’å†¬è…Šæœˆ", desc: "ä¸€å®¶äººå›´åœ¨ç«ç‚‰æ—ã€‚", left: { text: "ç»™å¨ƒè®²æ•…äº‹", effect: { culture: 1 }, nextId: "e5_spring" }, right: { text: "è§„åˆ’æ˜å¹´", effect: { common: 1 }, nextId: "e5_spring" } }, { id: "e4_fail", title: "è‰°éš¾æ±‚ç”Ÿ", desc: "æ—¥å­è™½ç„¶è‹¦ï¼Œä½†è¿˜èƒ½è¿‡ã€‚", left: { text: "...", effect: { common: 1 }, nextId: "e5_end_normal" }, right: { text: "...", effect: { common: 1 }, nextId: "e5_end_normal" } }, { id: "e4_family", title: "å„¿å­™æ»¡å ‚", desc: "ä½ çš„å­©å­ä»¬é•¿å¤§äº†ã€‚", left: { text: "æ•™å¯¼ä»–ä»¬ç§åœ°", effect: { common: 2 }, nextId: "e5_end_good" }, right: { text: "é€ä»–ä»¬å»è¯»ä¹¦", effect: { literary: 1 }, nextId: "e5_end_good" } }, { id: "e4_alone", title: "ç‹¬è‡ªä¸€äºº", desc: "ä½ ç‹¬è‡ªå®ˆç€å‡ äº©åœ°ã€‚", left: { text: "å­¤ç‹¬ç»ˆè€", effect: { common: 1 }, nextId: "e5_end_normal" }, right: { text: "å­¤ç‹¬ç»ˆè€", effect: { common: 1 }, nextId: "e5_end_normal" } }, { id: "e5_spring", title: "æ˜¥æš–èŠ±å¼€", desc: "å®˜åºœåˆè¦å¾ç¨äº†ã€‚", left: { text: "ç»§ç»­ç§åœ°", effect: { common: 2 }, nextId: "e6_end_farmer" }, right: { text: "å»åŸé‡Œçœ‹çœ‹", effect: { merchant: 1 }, nextId: "e6_end_merchant" } }, { id: "e6_end_farmer", title: "å¯Œå†œ", desc: "å®¶å¢ƒæ®·å®ã€‚", left: { text: "...", effect: { common: 3 }, nextId: "end" }, right: { text: "...", effect: { common: 3 }, nextId: "end" } }, { id: "e6_end_merchant", title: "å°å•†è´©", desc: "åšèµ·äº†å°ä¹°å–ã€‚", left: { text: "...", effect: { merchant: 2 }, nextId: "end" }, right: { text: "...", effect: { merchant: 2 }, nextId: "end" } }, { id: "e5_end_good", title: "å¯Œå†œ", desc: "å®¶å¢ƒæ®·å®ã€‚", left: { text: "...", effect: { common: 3 }, nextId: "end" }, right: { text: "...", effect: { common: 3 }, nextId: "end" } }, { id: "e5_end_normal", title: "è´«å†œ", desc: "ä¾ç„¶è´«å›°ã€‚", left: { text: "...", effect: { common: 1 }, nextId: "end" }, right: { text: "...", effect: { common: 1 }, nextId: "end" } } ] }
];

const specialEvents = [ { name: "æ±Ÿæ·®æ°´æ‚£", questions: [ { title: "æ´ªæ°´çˆ†å‘", desc: "è¿æ—¥æš´é›¨ï¼Œæ±Ÿæ·®å ¤åå†³å£ã€‚", left: { text: "æ‹¨æ¬¾èµˆç¾", effect: { treasury: -25, people: 20 } }, right: { text: "ä»¤åœ°æ–¹å®‰ç½®", effect: { treasury: 0, people: -5 } } }, { title: "ç–«ç—…é˜²æ²»", desc: "ç¾åç˜Ÿç–«æ¨ªè¡Œã€‚", left: { text: "é›†ä¸­éš”ç¦»", effect: { people: -10, culture: 10 } }, right: { text: "æ–½è¯æ•‘æ²»", effect: { treasury: -15, people: 15 } } }, { title: "é‡å»ºå®¶å›­", desc: "æ´ªæ°´é€€å»ã€‚", left: { text: "å¼ºå¾æ°‘å¤«", effect: { people: -15, military: 10 } }, right: { text: "ä»¥å·¥ä»£èµˆ", effect: { treasury: -20, people: 20 } } } ] }, { name: "å…³ä¸­å¤§æ—±", questions: [ { title: "èµ¤åœ°åƒé‡Œ", desc: "åº„ç¨¼æ¯æ­»ã€‚", left: { text: "å¼€ä»“æ”¾ç²®", effect: { treasury: -20, people: 15 } }, right: { text: "è®¾å›ç¥ˆé›¨", effect: { culture: 15, people: 5 } } }, { title: "æµæ°‘å››èµ·", desc: "æç”Ÿæ°‘å˜ã€‚", left: { text: "ä¸¥å‰é•‡å‹", effect: { military: 10, people: -15 } }, right: { text: "è®¾ç²¥æ£šæ–½ç²¥", effect: { treasury: -15, people: 20 } } }, { title: "æ¢å¤ç”Ÿäº§", desc: "æ—±æƒ…ç¼“è§£ã€‚", left: { text: "å‡å…èµ‹ç¨", effect: { treasury: -20, people: 20 } }, right: { text: "å‘æ”¾å†œå…·", effect: { treasury: -15, people: 10 } } } ] } ];
const crisisTree = [ { id: "crisis_1", title: "å®‰ç¦„å±±é€ å", desc: "èŒƒé˜³èŠ‚åº¦ä½¿å®‰ç¦„å±±ä»¥â€œæ¸…å›ä¾§â€ä¸ºåï¼Œèµ·å…µé€ åï¼", left: { text: "ç«‹å³æ´¾å…µé•‡å‹", effect: { military: -5, treasury: -10 }, nextId: "crisis_2_war" }, right: { text: "åšå®ˆæ½¼å…³å¾…æ´", effect: { people: -5, military: 5 }, nextId: "crisis_2_def" } }, { id: "crisis_2_war", title: "é‡æˆ˜å¤±åˆ©", desc: "å”å†›åœ¨å¹³åŸé‡æˆ˜å¤±åˆ©ã€‚", left: { text: "å¤„å†³è´¥å°†", effect: { military: 5, people: -5 }, nextId: "crisis_3_judge" }, right: { text: "é€€å®ˆæ½¼å…³", effect: { people: 5 }, nextId: "crisis_3_judge" } }, { id: "crisis_2_def", title: "åšå®ˆä¸å‡º", desc: "æ½¼å…³åšå®ˆæ•°æœˆï¼Œç²®è‰å°†å°½ã€‚", left: { text: "æ±‚æ´", effect: { treasury: -15, military: 10 }, nextId: "crisis_3_judge" }, right: { text: "å‡ºå‡»å†³æˆ˜", effect: { military: -10 }, nextId: "crisis_3_bad" } }, { id: "crisis_3_bad", title: "æ½¼å…³å¤±å®ˆ", desc: "é•¿å®‰å±åœ¨æ—¦å¤•ï¼", left: { text: "...", effect: { people: -20 }, nextId: "crisis_3_judge" }, right: { text: "...", effect: { people: -20 }, nextId: "crisis_3_judge" } }, { id: "crisis_3_judge", title: "å±æ€¥å­˜äº¡", desc: "å›å†›å…µä¸´åŸä¸‹ã€‚", left: { text: "å¾¡é©¾äº²å¾", effect: {}, nextId: "end_battle" }, right: { text: "å¼ƒåŸé€ƒå¾€èœ€åœ°", effect: {}, nextId: "end_flee" } } ];

const characterTypes = { general: { name: "é•‡å›½å¤§å°†", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character2.png", bonus: { military: 2 }, rarity: 'elite' }, merchant: { name: "çš‡å•†å·¨è´¾", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character1.png", bonus: { treasury: 2 }, rarity: 'elite' }, craftsman: { name: "å¤©å·¥å·§åŒ ", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character5.png", bonus: { treasury: 1, people: 1 }, rarity: 'elite' }, scholar: { name: "ç¿°æ—å­¦å£«", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character3.png", bonus: { culture: 2 }, rarity: 'elite' }, soldier: { name: "ç²¾é”å£«å’", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character2.png", bonus: { military: 1 }, rarity: 'common' }, peddler: { name: "å¸‚äº•å•†è´©", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character4.png", bonus: { treasury: 0.5 }, rarity: 'common' }, farmer: { name: "ç§ç”°èƒ½æ‰‹", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character6.png", bonus: { people: 1 }, rarity: 'common' }, teacher: { name: "ä¹¡æ‘æ•™å¸ˆ", icon: "https://cdn.jsdelivr.net/gh/LuoshuiCat/-demo@main/assets/character3.png", bonus: { culture: 0.5 }, rarity: 'common' } };

// æ¸¸æˆçŠ¶æ€
let currentPhase = "POLICY", currentCardIndex = 0, currentDeck = [], cardMap = {}, nextCardId = null, charScores = {}, gameTime = 0, finalCountdown = 300, incomeTimer = 0, recruitSlots = 0, recruitTimer = 90, specialEventTriggered = false, pendingDisaster = false, characters = [], gameLoopInterval, lastTime = 0, lastStoryIndex = -1;
const ui = { eventTitle: document.getElementById('event-title'), eventDesc: document.getElementById('event-desc'), txtLeft: document.getElementById('txt-left'), txtRight: document.getElementById('txt-right'), swipeCard: document.getElementById('swipe-card'), buildingsContainer: document.getElementById('buildings-container'), overlay: document.getElementById('overlay'), resultTitle: document.getElementById('result-title'), resultDesc: document.getElementById('result-desc'), idlePanel: document.getElementById('idle-panel'), finalTimer: document.getElementById('final-timer'), incomeStats: document.getElementById('income-stats'), sideUI: document.getElementById('side-ui'), recruitBtn: document.getElementById('recruit-btn'), recruitStatus: document.getElementById('recruit-status'), progressRing: document.querySelector('#progress-ring circle'), disasterBtn: document.getElementById('disaster-btn'), optLeft: document.querySelector('.option-left'), optRight: document.querySelector('.option-right') };

function initGame() {
    resources = { treasury: 50, people: 50, military: 50, culture: 50 }; incomeRates = { treasury: 5, people: 5, military: 5, culture: 5 }; 
    // ä¿®å¤ï¼šåˆå§‹åŒ– buildingLevels
    buildingLevels = { treasury: 0, people: 0, military: 0, culture: 0 }; 
    occupiedPositions = { back: [], mid: [], front: [] }; spawnedBuildings = { treasury: [], people: [], military: [], culture: [] }; characters = []; gameTime = 0; recruitSlots = 0; recruitTimer = 90; specialEventTriggered = false; pendingDisaster = false; currentPhase = "POLICY"; currentCardIndex = 0; currentDeck = [];
    ui.buildingsContainer.innerHTML = ''; ui.overlay.style.display = 'none'; ui.idlePanel.style.display = 'none'; ui.sideUI.style.display = 'none'; ui.swipeCard.style.display = 'flex';
    updateUI(); updateRecruitUI(); loadDeck(policyTrees[Math.floor(Math.random() * policyTrees.length)]); showNextCard(); setupSwipeEvents();
    if(gameLoopInterval) clearInterval(gameLoopInterval); lastTime = Date.now(); gameLoopInterval = setInterval(gameLoop, 100);
}
function loadDeck(d) { currentDeck = d; cardMap = {}; currentDeck.forEach(c => cardMap[c.id] = c); nextCardId = currentDeck.length ? currentDeck[0].id : null; }
function gameLoop() { let n = Date.now(), dt = (n - lastTime) / 1000; lastTime = n; if (recruitSlots < 3) { recruitTimer -= dt; if (recruitTimer <= 0) { recruitSlots++; recruitTimer = 90; updateRecruitUI(); } } updateRecruitRing(); if (currentPhase === "IDLE") { gameTime += dt; incomeTimer += dt; if (incomeTimer >= 15) { incomeTimer = 0; applyIncome(); } let r = finalCountdown - gameTime; if (r <= 180 && !specialEventTriggered) triggerSpecialEvent(); if (r <= 0) startCrisis(); else ui.finalTimer.innerText = `å®‰å²ä¹‹ä¹±å€’è®¡æ—¶: ${Math.floor(r/60)}:${String(Math.floor(r%60)).padStart(2,'0')}`; updateCharacterPositions(dt); } }
function applyIncome() { for (let k in resources) { resources[k] += incomeRates[k]; highlightRes(k, true); checkBuildingUpgrades(k); } updateUI(); let h = checkHighStatFail(); if (h) { showResult(false, h); clearInterval(gameLoopInterval); } }

// ä¼˜åŒ–ï¼šç§»é™¤setTimeoutï¼Œæ”¹ç”¨CSSç±»åˆ‡æ¢
function highlightRes(k, isIncrease) { 
    let e = document.getElementById(`res-item-${k}`); 
    let valEl = e.querySelector('.res-value');
    if (isIncrease) { valEl.classList.add('highlight'); setTimeout(() => valEl.classList.remove('highlight'), 300); valEl.classList.remove('warning'); }
    else { valEl.classList.add('guess'); } // æ–°å¢ guess ç±»
}
function clearGuessHighlight() { document.querySelectorAll('.res-value').forEach(e => e.classList.remove('guess')); }

function checkHighStatFail() { let m = 0, mk = ''; for (let k in resources) if (resources[k] > m) { m = resources[k]; mk = k; } if (m > 250) { if (mk === 'military') return "æ­¦å°†æƒå€¾æœé‡ï¼Œæ”¿å±€å´©åã€‚"; if (mk === 'culture') return "æ€æƒ³è¿‡å‰©ï¼Œæ¨ç¿»äº†æ”¿æƒã€‚"; if (mk === 'treasury') return "å®˜å¯Œæ°‘ç©·ï¼Œå¤©ä¸‹å¤§ä¹±ã€‚"; if (mk === 'people') return "å›ä¸»å·²æˆå¤©å‘½ï¼Œå¤©ä¸‹å¤§ä¹±ã€‚"; } if (m > 200) document.getElementById(`res-item-${mk}`).querySelector('.res-value').classList.add('warning'); return null; }
function updateUI() { document.getElementById('res-treasury').innerText = Math.floor(resources.treasury); document.getElementById('res-people').innerText = Math.floor(resources.people); document.getElementById('res-military').innerText = Math.floor(resources.military); document.getElementById('res-culture').innerText = Math.floor(resources.culture); ui.incomeStats.innerHTML = `<span>ğŸ’° +${incomeRates.treasury.toFixed(0)}/15s</span><span>ğŸ‘¥ +${incomeRates.people.toFixed(0)}/15s</span><span>âš”ï¸ +${incomeRates.military.toFixed(0)}/15s</span><span>ğŸ“œ +${incomeRates.culture.toFixed(0)}/15s</span>`; }
function updateRecruitUI() { ui.recruitStatus.innerText = `æ‹›å‹Ÿ(${recruitSlots})`; ui.recruitBtn.classList.toggle('active', recruitSlots > 0); }
function updateRecruitRing() { ui.progressRing.style.strokeDashoffset = recruitSlots >= 3 ? 188.5 : 188.5 * (recruitTimer / 90); }

// ä¿®å¤ï¼šç¡®ä¿ buildingLevels æœ‰åˆå§‹å€¼
function checkBuildingUpgrades(t) { 
    let v = resources[t]; 
    let l = buildingLevels[t] || 0; // å…³é”®ä¿®å¤
    for (let i = l; i < BUILD_THRESHOLDS.length; i++) { 
        if (v >= BUILD_THRESHOLDS[i]) { 
            spawnBuilding(t); 
            buildingLevels[t] = i + 1; // è®°å½•å·²è¾¾åˆ°çš„ç­‰çº§
        } 
    } 
}

function spawnBuilding(t) { const d = buildingDefinitions[t]; if(!d) return; let a = d.filter(x => !spawnedBuildings[t].includes(x.name)); if(!a.length) { spawnedBuildings[t] = []; a = d; } const b = a[Math.floor(Math.random() * a.length)]; spawnedBuildings[t].push(b.name); const div = document.createElement('div'); div.className = 'building'; 
    // æ”¯æŒå›¾ç‰‡URL
    let iconHtml = b.icon.startsWith('http') ? `<div class="building-icon"><img src="${b.icon}"></div>` : `<div class="building-icon">${b.icon}</div>`;
    div.innerHTML = `${iconHtml}<span>${b.name}</span>`;
    const rows = [{ n:'back', b:55, s:0.75, z:1 }, { n:'mid', b:35, s:0.95, z:2 }, { n:'front', b:15, s:1.15, z:3 }]; const row = rows[Math.floor(Math.random() * rows.length)]; let p = -1; for(let i=0; i<20; i++) { let tp = Math.random()*80+10; if(!occupiedPositions[row.n].some(e => Math.abs(e-tp)<30)) { p = tp; break; } } if(p===-1) p = Math.random()*80+10; occupiedPositions[row.n].push(p); div.style.cssText = `left:${p}%;bottom:${row.b}%;transform:scale(${row.s});z-index:${row.z}`; ui.buildingsContainer.appendChild(div); 
}
function triggerSpecialEvent() { specialEventTriggered = true; pendingDisaster = true; ui.disasterBtn.classList.add('show'); }
function handleDisaster() { if(!pendingDisaster) return; pendingDisaster = false; ui.disasterBtn.classList.remove('show'); currentPhase = "SPECIAL_EVENT"; const e = specialEvents[Math.floor(Math.random() * specialEvents.length)]; currentDeck = e.questions; cardMap = {}; nextCardId = null; currentCardIndex = 0; ui.idlePanel.style.display = 'none'; ui.swipeCard.style.display = 'flex'; ui.eventTitle.style.opacity = 1; ui.eventDesc.style.opacity = 1; ui.eventTitle.innerText = "çªå‘äº‹ä»¶"; ui.eventDesc.innerText = `ã€${e.name}ã€‘çˆ†å‘ï¼`; setTimeout(showNextCard, 1500); }
function checkGameFail() { if (resources.treasury <= 0) return "å›½åº“ç©ºè™šï¼Œç‹æœæºƒæ•£"; if (resources.people <= 0) return "æ°‘å¿ƒæ¶£æ•£ï¼Œç‹æœè¦†ç­"; if (resources.military <= 0) return "å†›åŠ›è–„å¼±ï¼Œç‹æœè¦†ç­"; if (resources.culture <= 0) return "ç¤¼ä¹å´©å"; return null; }
function showNextCard() { if (nextCardId === "end_battle" || nextCardId === "end_flee") { calculateEnding(); return; } if (nextCardId === "end") { if (currentPhase === "POLICY") { startEvolution(); return; } if (currentPhase === "CHAR_CREATION") { finishCharacterCreation(); return; } if (currentPhase === "SPECIAL_EVENT") { finishSpecialEvent(); return; } return; } let c = nextCardId ? cardMap[nextCardId] : currentDeck[currentCardIndex]; if (!c) { console.error("Card missing", nextCardId); if(currentPhase==="POLICY") startEvolution(); else finishCharacterCreation(); return; } ui.eventTitle.innerText = c.title; ui.eventDesc.innerText = c.desc; ui.txtLeft.innerText = c.left ? c.left.text : "..."; ui.txtRight.innerText = c.right ? c.right.text : "..."; ui.swipeCard.style.transition = 'none'; ui.swipeCard.style.transform = 'translateX(0) rotate(0)'; updateCardVisual(0); }
function handleChoice(d) { let c = nextCardId ? cardMap[nextCardId] : currentDeck[currentCardIndex]; if(!c) return; let ch = d === 'left' ? c.left : c.right; if(!ch) return; if (currentPhase === "POLICY" || currentPhase === "SPECIAL_EVENT" || currentPhase === "CRISIS") { for (let k in ch.effect) if(resources[k] !== undefined) { resources[k] += ch.effect[k]; if(resources[k] < 0) resources[k] = 0; if (currentPhase === "POLICY") checkBuildingUpgrades(k); } updateUI(); let f = checkGameFail(); if (f) { setTimeout(() => showResult(false, f), 300); clearInterval(gameLoopInterval); return; } let h = checkHighStatFail(); if (h) { setTimeout(() => showResult(false, h), 300); clearInterval(gameLoopInterval); return; } } else if (currentPhase === "CHAR_CREATION") { for (let k in ch.effect) charScores[k] = (charScores[k] || 0) + ch.effect[k]; } nextCardId = ch.nextId || null; if (!ch.nextId) currentCardIndex++; }
function finishSpecialEvent() { ui.eventTitle.innerText = "äº‹æ€å¹³æ¯"; ui.eventDesc.innerText = ""; setTimeout(() => { currentPhase = "IDLE"; ui.swipeCard.style.display = 'none'; ui.eventTitle.style.opacity = 0; ui.eventDesc.style.opacity = 0; ui.idlePanel.style.display = 'block'; }, 2000); }

// æ»‘åŠ¨é€»è¾‘ä¼˜åŒ–
let isDragging = false, startX = 0, currentX = 0; const THRESHOLD = 100;
function setupSwipeEvents() { let c = ui.swipeCard; c.addEventListener('touchstart', e => { if(currentPhase!=="IDLE") dragStart(e); }); c.addEventListener('touchmove', e => { if(currentPhase!=="IDLE") drag(e); }); c.addEventListener('touchend', e => { if(currentPhase!=="IDLE") dragEnd(e); }); c.addEventListener('mousedown', e => { if(currentPhase!=="IDLE") dragStart(e); }); document.addEventListener('mousemove', e => { if(currentPhase!=="IDLE") drag(e); }); document.addEventListener('mouseup', e => { if(currentPhase!=="IDLE") dragEnd(e); }); }
function dragStart(e) { isDragging = true; startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX; ui.swipeCard.style.transition = 'none'; }
function drag(e) { if (!isDragging) return; e.preventDefault(); currentX = (e.type.includes('mouse') ? e.clientX : e.touches[0].clientX) - startX; ui.swipeCard.style.transform = `translateX(${currentX}px) rotate(${currentX * 0.05}deg)`; updateCardVisual(currentX); }
function dragEnd(e) { if (!isDragging) return; isDragging = false; clearGuessHighlight(); if (Math.abs(currentX) > THRESHOLD) { let d = currentX > 0 ? 'right' : 'left'; 
    // ä¼˜åŒ–ï¼šå…ˆæ‰§è¡ŒåŠ¨ç”»
    let flyX = (d === 'right' ? 500 : -500);
    ui.swipeCard.style.transition = 'transform 0.4s ease-in'; // åŠ å¿«ä¸€ç‚¹
    ui.swipeCard.style.transform = `translateX(${flyX}px) rotate(${d === 'right' ? 30 : -30}deg)`;
    // å»¶è¿Ÿæ‰§è¡Œé€»è¾‘ï¼Œè®©åŠ¨ç”»å…ˆè·‘èµ·æ¥
    setTimeout(() => { handleChoice(d); showNextCard(); }, 350); 
} else { ui.swipeCard.style.transition = 'transform 0.3s ease-out'; ui.swipeCard.style.transform = 'translateX(0) rotate(0)'; updateCardVisual(0); } currentX = 0; }
function updateCardVisual(x) { ui.optLeft.classList.toggle('active-bg', x < -10); ui.optRight.classList.toggle('active-bg', x > 10); if (Math.abs(x) > 30) { let c = nextCardId ? cardMap[nextCardId] : currentDeck[currentCardIndex]; if(!c) return; if (currentPhase === "POLICY" || currentPhase === "SPECIAL_EVENT" || currentPhase === "CRISIS") { let eff = (x < 0) ? c.left.effect : c.right.effect; clearGuessHighlight(); if(eff) for (let k in eff) highlightRes(k, false); } } else clearGuessHighlight(); }

function startEvolution() { currentPhase = "IDLE"; ui.eventTitle.style.opacity = 0; ui.eventDesc.style.opacity = 0; ui.swipeCard.style.display = 'none'; ui.idlePanel.style.display = 'block'; ui.sideUI.style.display = 'flex'; for(let k in resources) checkBuildingUpgrades(k); recruitSlots = 2; recruitTimer = 90; updateRecruitUI(); }
function tryStartRecruit() { if (recruitSlots <= 0 || currentPhase !== "IDLE") return; recruitSlots--; updateRecruitUI(); currentPhase = "CHAR_CREATION"; let av = characterStories.filter((s, i) => i !== lastStoryIndex); if (!av.length) av = characterStories; const s = av[Math.floor(Math.random() * av.length)]; lastStoryIndex = characterStories.indexOf(s); loadDeck(s.list); nextCardId = s.list[0].id; charScores = {}; ui.swipeCard.style.display = 'flex'; ui.eventTitle.style.opacity = 1; ui.eventDesc.style.opacity = 1; ui.idlePanel.style.display = 'none'; ui.eventTitle.innerText = "å‘½è¿çš„é½¿è½®"; ui.eventDesc.innerText = `ã€${s.name}ã€‘\nä¸€æ®µæ–°çš„äººç”Ÿ...`; setTimeout(showNextCard, 2000); }
function finishCharacterCreation() { let m = 'common', mv = 0; for(let k in charScores) if(charScores[k] > mv) { mv = charScores[k]; m = k; } let tk = 'farmer', isE = false; if (m === 'literary') tk = mv >= 5 ? 'scholar' : 'teacher'; else if (m === 'martial') tk = mv >= 5 ? 'general' : 'soldier'; else if (m === 'merchant') tk = mv >= 5 ? 'merchant' : 'peddler'; else if (m === 'tech') tk = mv >= 5 ? 'craftsman' : 'farmer'; else tk = mv >= 5 ? 'craftsman' : 'farmer'; if (tk === 'scholar' || tk === 'general' || tk === 'merchant') isE = true; if (tk === 'craftsman' && mv >= 6) isE = true; const td = characterTypes[tk]; let bm = isE ? 1 : 0.5; for(let k in td.bonus) incomeRates[k] += td.bonus[k] * bm; let bb = { culture: 10, people: 10, military: 10, treasury: 10 }; for(let k in bb) resources[k] += bb[k] * (td.bonus[k] ? 2 : 1) * bm; updateUI(); for(let k in resources) checkBuildingUpgrades(k); spawnCharacterEntity(td.icon, isE); let rt = isE ? "ã€æ°å‡ºäººæ‰ã€‘" : "ã€æ™®é€šäººæ‰ã€‘"; ui.eventTitle.innerText = "æ•…äº‹è½å¹•"; ui.eventDesc.innerText = `${rt}\n${td.name} å†ç»æ³¢æŠ˜ï¼Œæ¥åˆ°äº†æ‚¨èº«è¾¹ã€‚`; setTimeout(() => { currentPhase = "IDLE"; ui.swipeCard.style.display = 'none'; ui.eventTitle.style.opacity = 0; ui.eventDesc.style.opacity = 0; ui.idlePanel.style.display = 'block'; updateRecruitUI(); }, 2500); }
function startCrisis() { currentPhase = "CRISIS"; loadDeck(crisisTree); nextCardId = crisisTree[0].id; ui.idlePanel.style.display = 'none'; ui.swipeCard.style.display = 'flex'; ui.eventTitle.style.opacity = 1; ui.eventDesc.style.opacity = 1; ui.eventTitle.innerText = "å¤©ä¸‹å¤§ä¹±"; ui.eventDesc.innerText = "å®‰å²ä¹‹ä¹±çˆ†å‘ï¼"; clearInterval(gameLoopInterval); setTimeout(showNextCard, 2000); }
function calculateEnding() { let w = false, t = ""; if (nextCardId === "end_battle") { if (resources.military >= 50 && resources.people >= 40) { w = true; t = "å¾¡é©¾äº²å¾ï¼Œå¤§ç ´å›å†›ï¼\nå¤§å”å›½ç¥šå¾—ä»¥å»¶ç»­ç™¾å¹´ã€‚"; } else { w = false; t = "å†›å¿ƒæ¶£æ•£ï¼Œæºƒè´¥ã€‚"; } } else if (nextCardId === "end_flee") { if (resources.treasury >= 50 || resources.people >= 60) { w = true; t = "å¿è¾±è´Ÿé‡ï¼Œé€€å®ˆèœ€åœ°ã€‚"; } else { w = false; t = "é€ƒäº¡è·¯ä¸Šï¼Œç¦å†›å“—å˜ã€‚"; } } else { if (resources.military >= 60) { w = true; t = "å‡­å€Ÿå¼ºå¤§çš„å†›åŠ›ï¼Œè‰°éš¾å¹³å›ã€‚"; } else { w = false; t = "æ— åŠ›å›å¤©ã€‚"; } } showResult(w, t); }

// å®ä½“ç”Ÿæˆ
function spawnCharacterEntity(icon, isE) { const ct = document.getElementById('buildings-container'), rc = ct.getBoundingClientRect(); const el = document.createElement('div'); el.className = 'character-entity'; if (isE) el.classList.add('character-elite'); if (typeof icon === 'string' && icon.startsWith('http')) { const img = document.createElement('img'); img.src = icon; img.style.cssText = 'width:100%;height:100%;object-fit:cover'; el.appendChild(img); } else el.innerText = icon; const x = Math.random() * (rc.width - 30), y = Math.random() * (rc.height * 0.4) + (rc.height * 0.35); el.style.left = x + 'px'; el.style.top = y + 'px'; ct.appendChild(el); characters.push({ el, x, y, tx: x, ty: y, sp: 20 + Math.random() * 20, b: { w: rc.width, h: rc.height } }); }
function updateCharacterPositions(dt) { characters.forEach(c => { let dx = c.tx - c.x, dy = c.ty - c.y, ds = Math.sqrt(dx*dx + dy*dy); if (ds < 5) { c.tx = Math.random() * (c.b.w - 30); c.ty = Math.random() * (c.b.h * 0.4) + (c.b.h * 0.35); } else { c.x += (dx / ds) * c.sp * dt; c.y += (dy / ds) * c.sp * dt; c.el.style.left = c.x + 'px'; c.el.style.top = c.y + 'px'; } }); }
function showResult(w, t) { ui.overlay.style.display = 'flex'; ui.resultTitle.innerText = w ? "âœ¨ æ¨¡æ‹ŸæˆåŠŸ âœ¨" : "ğŸ’€ æ¨¡æ‹Ÿå¤±è´¥ ğŸ’€"; ui.resultDesc.innerText = t; ui.resultDesc.style.color = w ? "#5cb85c" : "#d9534f"; }

initGame();